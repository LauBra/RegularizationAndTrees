import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import (
accuracy_score,
roc_auc_score,
classification_report,
confusion_matrix
)
np.random.seed(123)
url = "https://raw.githubusercontent.com/npradaschnor/Pima-Indians-Diabetes-Dataset/master/diabetes.csv"
pima = pd.read_csv(url)
# Keep a smaller set of predictors
pima = pima[["Glucose", "Outcome", "BloodPressure", "Age"]]
# Binary outcome: 1 = diabetes, 0 = no diabetes
pima["Diabetes_binary"] = (pima["Outcome"] == 1).astype(int)
pima.head()
pima.info()
X = pima[["Glucose", "BloodPressure", "Age"]]
y = pima["Diabetes_binary"]
X.head(), y.head()
X_train, X_test, y_train, y_test = train_test_split(
X,
y,
test_size=0.3,
random_state=123,
stratify=y
)
X_train.shape, X_test.shape
pd.Series(y_train).value_counts(normalize=True), pd.Series(y_test).value_counts(normalize=True)
rf_basic = RandomForestClassifier(
random_state=123
)
rf_basic.fit(X_train, y_train)
y_pred_train_basic = rf_basic.predict(X_train)
y_proba_train_basic = rf_basic.predict_proba(X_train)[:, 1]
train_acc_basic = accuracy_score(y_train, y_pred_train_basic)
train_roc_basic = roc_auc_score(y_train, y_proba_train_basic)
train_acc_basic, train_roc_basic
y_pred_test_basic = rf_basic.predict(X_test)
y_proba_test_basic = rf_basic.predict_proba(X_test)[:, 1]
test_acc_basic = accuracy_score(y_test, y_pred_test_basic)
test_roc_basic = roc_auc_score(y_test, y_proba_test_basic)
test_acc_basic, test_roc_basic
pipe = Pipeline(
steps=[
("scaler", StandardScaler()),
("rf", RandomForestClassifier(random_state=123))
]
)
pipe
param_grid = {
"rf__n_estimators": [200, 500],
"rf__max_depth": [None, 3, 5, 7],
"rf__min_samples_leaf": [1, 5, 10],
}
param_grid
grid = GridSearchCV(
estimator=pipe,
param_grid=param_grid,
cv=5,
scoring="roc_auc",
n_jobs=-1,
refit=True,
)
grid
grid.fit(X_train, y_train)
best_params = grid.best_params_
best_cv_score = grid.best_score_
best_params, best_cv_score
y_pred_test = grid.predict(X_test)
y_proba_test = grid.predict_proba(X_test)[:, 1]
test_acc = accuracy_score(y_test, y_pred_test)
test_roc = roc_auc_score(y_test, y_proba_test)
print("Test accuracy:", test_acc)
print("Test ROC AUC:", test_roc)
print("\nConfusion matrix (test):")
print(confusion_matrix(y_test, y_pred_test))
print("\nClassification report (test):")
print(classification_report(y_test, y_pred_test))
y_pred_train = grid.predict(X_train)
y_proba_train = grid.predict_proba(X_train)[:, 1]
train_acc = accuracy_score(y_train, y_pred_train)
train_roc = roc_auc_score(y_train, y_proba_train)
print("Train accuracy:", train_acc)
print("Train ROC AUC:", train_roc)
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import (
accuracy_score,
roc_auc_score,
classification_report,
confusion_matrix
)
np.random.seed(123)
url = "https://raw.githubusercontent.com/npradaschnor/Pima-Indians-Diabetes-Dataset/master/diabetes.csv"
pima = pd.read_csv(url)
# Keep a smaller set of predictors
pima = pima[["Glucose", "Outcome", "BloodPressure", "Age"]]
# Binary outcome: 1 = diabetes, 0 = no diabetes
pima["Diabetes_binary"] = (pima["Outcome"] == 1).astype(int)
pima.head()
library(reticulate)
# one-off setup (if you haven't done it yet)
# install_miniconda()
##conda_create(
##  envname = "hds-python",
##  python_version = "3.11",
##  packages = c("numpy", "pandas", "matplotlib", "seaborn", "scikit-learn")
##)
use_condaenv("hds-python", required = TRUE)
#py_config()
#conda_install("hds-python", c("jupyter", "plotly"))
reticulate::repl_python()
